# 💡 SudoCube - 3D 数独网页游戏 – 需求文档（可配置棋盘规模）

## 一、项目概述

**项目名称：SudoCube**

SudoCube 是一款构建于 **Three.js** 的浏览器端 3D 数独游戏。区别于传统固定 9×9 数独，玩家可在开始游戏时自定义棋盘规模（如 4×4、6×6、9×9、12×12、16×16 等），系统按照所选规模自动生成题目并完成校验。项目追求观感酷炫、交互友好，并保留良好的扩展性以支持更多玩法。

---

## 二、开发目标

* **可配置棋盘规模**：支持常见数独尺寸；默认 9×9，可在开始游戏前选择。
* **模块化架构设计**：各功能模块清晰分离，便于维护与功能拓展。
* **3D 棋盘渲染与交互**：点击选格、键盘/数字面板输入、格子高亮。
* **题目生成与唯一解校验**：根据棋盘规模动态生成符合规则、保证唯一解的数独题。
* **游戏流程控制**：开始、重置、检查、难度选择、胜利提示。
* **良好性能**：在主流桌面与移动浏览器保持 ≥60 FPS 渲染。
* **错误提示**：若输入数字与当前行、列、宫内出现冲突，高亮显示对应格子，提示错误。
* **自动保存/恢复进度**：每次输入后通过 localStorage 保存状态，重新进入页面时自动恢复。
* **计时器**：游戏开始时记录时间，胜利后显示总耗时。
* **撤销/重做**：支持撤销上一次操作，重做下一步，增强操作展现。
* **夜间模式 / 主题切换**：支持深色/日间主题切换，更好适配环境。
* **数字面板（适配移动端）**：点击格子后显示数字面板，方便移动端输入。
* **存档系统**：支持手动存档和恢复，允许保存多个进度。
* **3D 特效加强**：包括格子入场动画、输入动画、动态镜头切换、胜利粒子效果等。
* **多种胜利动画可配置**：提供不同类型的胜利反馈动画（如旋转、粒子爆炸、镜头移动等），支持主题切换或用户自定义风格。

---

## 三、技术栈

| 层级   | 技术/库                       |
| ---- | -------------------------- |
| 渲染引擎 | Three.js（WebGL 3D）         |
| 构建工具 | Vite（热更新、打包）               |
| 编程语言 | TypeScript                 |
| 状态管理 | Pinia                      |
| 架构模式 | 模块化：核心逻辑、渲染、交互、UI、状态分离     |
| 题目逻辑 | 前端内置通用 N×N 数独生成/求解算法       |
| 部署   | 暂不部署，使用 `npm run dev` 本地运行 |

---

## 四、功能模块

### 1. 初始化与棋盘规模选择

* 启动界面提供尺寸选择（4×4、6×6、9×9、12×12、16×16）
* 系统据此构建棋盘几何、子宫格线

### 2. 棋盘渲染与数字显示

* 根据棋盘规模生成 N×N 格子
* 支持子宫格粗线条/不同背景色区分
* 数字显示使用 `TextGeometry` 或 Sprite，支持 1~~9、A~~F 等符号集

### 3. 用户交互

* Raycaster 检测点击格子 → 高亮选中
* 支持键盘输入 & 移动端数字面板
* 预设数字不可更改
* 输入后即时检查冲突（错误提示）

### 4. 游戏控制功能

* “新游戏”“重置”“检查答案”按钮
* “撤销 / 重做”操作栈
* “存档 / 读档”功能
* 游戏完成时触发胜利提示 + 特效（粒子、相机动画等）
* 胜利动画多种可选风格（配置项）

### 5. UI & 动画设计

* 左/上侧工具栏（控制按钮、难度选择、计时器）
* 格子高亮、渐现动画、3D 镜头变换
* 夜间主题切换支持

---

## 五、数据结构与算法抽象

```ts
interface SudokuConfig {
  size: number;          // 棋盘边长 n
  subRows: number;       // 子宫格行数
  subCols: number;       // 子宫格列数
  difficulty: 'easy' | 'medium' | 'hard';
}
```

> `size = subRows * subCols`，例如 6x6 是 2x3 子宫格

核心算法模块：

```ts
generatePuzzle(config: SudokuConfig): { puzzle: number[][], solution: number[][] }
validateBoard(board: number[][], config: SudokuConfig): ValidationResult
isSolved(board: number[][], solution: number[][]): boolean
```

---

## 六、功能优先级与迭代计划

| 阶段       | 目标                                 |
| -------- | ---------------------------------- |
| **v0.1** | 可调棋盘 → 创建棋盘 → 基础点击输入 → 数字渲染 → 胜利判断 |
| **v0.2** | 加入题目生成/求解算法 → 校验功能 → 难度参数          |
| **v0.3** | 自动保存/恢复 → 计时器 → 撤销重做 → UI 面板/移动适配  |
| **v0.4** | 存档系统 → 夜间主题切换 → 特效系统（粒子、动画、镜头）     |

---

## 七、风险与解决方案

| 风险               | 应对策略                                  |
| ---------------- | ------------------------------------- |
| 大棋盘性能下降（如 16x16） | 使用 InstancedMesh / 合并几何，优化材质渲染        |
| 难度控制影响题目生成速度     | 预生成题库 + 使用 Web Worker 异步处理            |
| 移动端输入不便          | 引入数字面板，自动调出或长按触发                      |
| 棋盘配置非法（如 5x5）    | 只暴露合法组合，如 4x4(2x2)、6x6(2x3)、9x9(3x3)等 |

---

## 八、结语

SudoCube 是一款旨在用现代 3D 图形技术重新定义数独体验的项目。其可配置性、模块化架构、多平台适配、视觉特效及可拓展设计，将为用户和开发者提供极大的自由度。随着功能逐步迭代，它可从单机益智工具扩展至排行榜、挑战模式、多人联机等完整产品形态。



模块结构图（逻辑划分）

SudoCube (Root)
├── core/                 # 核心逻辑模块
│   ├── generator.ts      # 数独题目生成器
│   ├── solver.ts         # 数独求解器
│   ├── validator.ts      # 输入验证与胜利判断
│   └── types.ts          # 公共类型定义（如 SudokuConfig）
│
├── renderer/            # Three.js 渲染相关
│   ├── scene.ts          # 初始化 Three 场景和摄像机
│   ├── board.ts          # 构建棋盘网格（动态生成）
│   ├── cell.ts           # 单个格子构造/样式
│   └── text.ts           # 数字几何体（TextGeometry/Sprite）
│
├── interactor/          # 用户交互模块
│   ├── inputManager.ts   # 键盘/鼠标/触屏输入处理
│   ├── raycaster.ts      # 点击射线检测
│   └── highlighter.ts    # 格子高亮逻辑
│
├── store/               # 状态管理（Pinia）
│   └── gameStore.ts      # 当前棋盘状态、计时器、撤销记录等
│
├── ui/                  # UI 控件与主题
│   ├── HUD.vue           # 游戏顶部工具栏（难度、计时器、按钮）
│   ├── NumPad.vue        # 数字面板（移动端）
│   └── ThemeToggle.vue   # 夜间模式切换
│
├── animations/          # 动画和特效
│   ├── cellAnimations.ts # 格子选中、输入动画
│   ├── winEffects.ts     # 粒子动画 / 镜头切换等
│   └── transition.ts     # 主题/模式切换过渡
│
├── utils/               # 工具函数
│   ├── formatter.ts      # 格式化数字（A-F）
│   ├── saver.ts          # 存档 / 恢复 / localStorage
│   └── timer.ts          # 通用计时器逻辑
│
├── App.vue              # 应用入口组件
└── main.ts              # 入口文件（初始化 Renderer、Store、UI）
